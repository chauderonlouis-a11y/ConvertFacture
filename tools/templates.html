<!doctype html>
<html lang="fr">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G-V4JG3WWYP5"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-G-V4JG3WWYP5');
    </script>

    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <meta name="theme-color" content="#111827">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ConvertFacture — Modèles Factur-X</title>
    <meta name="description" content="Choisissez un modèle Factur-X (freelance, artisan, agence…). PoC : laissez votre email pour être prévenu." />
    <link rel="stylesheet" href="../styles.css" />
</head>

<body>
    <!-- Top bar -->
    <header class="topbar">
        <div class="container topbar__inner">
            <a class="brand" href="../index.html" aria-label="ConvertFacture">
                <span class="brand__mark">C</span>
                <span class="brand__name">ConvertFacture</span>
            </a>

            <nav class="nav nav--pill">
                <a class="nav__link nav__link--active" href="../index.html#tools">Outils</a>
                <a class="nav__link" href="../pricing.html">Tarifs</a>
                <a class="nav__link" href="../contact.html">Contact</a>
            </nav>

            <div class="actions">
                <a class="btn btn--primary btn--cta" href="../contact.html">Nous contacter</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero -->
        <section class="hero hero--tight">
            <div class="container hero__inner">
                <h1>Modèles Factur-X</h1>
                <p>
                    Choisissez un modèle (freelance, artisan, agence…) et générez plus vite une facture conforme.
                    <br />
                    <strong>PoC :</strong> cliquez sur un modèle → on vous propose d’être prévenu quand c’est prêt.
                </p>
            </div>
        </section>

        <!-- Main card -->
        <section class="tool">
            <div class="container">
                <div class="tool-card tool-card--center">
                    <h2>Choisir un modèle</h2>
                    <p class="muted">
                        Les modèles sont en développement. Choisissez celui qui vous correspond le mieux.
                    </p>

                    <!-- Big area with template cards -->
                    <div class="dropzone dropzone--big" id="dropzone" tabindex="0" aria-label="Choisir un modèle (bêta)">
                        <div class="dropzone__icon dropzone__icon--big" aria-hidden="true">
                            <!-- Doc icon -->
                            <svg viewBox="0 0 24 24" fill="none">
                                <path d="M8 7h8M8 11h8M8 15h5" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" />
                                <path d="M6 3h9l3 3v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.7" />
                                <path d="M15 3v4a1 1 0 0 0 1 1h4" stroke="currentColor" stroke-width="1.7" />
                            </svg>
                        </div>

                        <div class="dropzone__text" style="width:100%; max-width: 760px;">
                            <div class="dropzone__title">Modèles disponibles (bientôt)</div>
                            <div class="dropzone__sub">Clique sur un modèle pour être prévenu</div>

                            <div class="tpl-grid" aria-label="Liste de modèles">
                                <button class="tpl-card" type="button" data-template="freelance">
                                    <div class="tpl-title">Freelance</div>
                                    <div class="tpl-sub">Prestations • TJM • TVA simple</div>
                                </button>

                                <button class="tpl-card" type="button" data-template="artisan">
                                    <div class="tpl-title">Artisan</div>
                                    <div class="tpl-sub">Devis → facture • matériaux</div>
                                </button>

                                <button class="tpl-card" type="button" data-template="agence">
                                    <div class="tpl-title">Agence</div>
                                    <div class="tpl-sub">Abonnements • lots • projets</div>
                                </button>

                                <button class="tpl-card" type="button" data-template="ecommerce">
                                    <div class="tpl-title">E-commerce</div>
                                    <div class="tpl-sub">Produits • livraison • remises</div>
                                </button>
                            </div>

                            <div class="dropzone__hint" style="margin-top:10px;">
                                PoC : aucun modèle n’est généré — on mesure juste l’intérêt.
                            </div>
                        </div>
                    </div>

                    <div class="tool-actions tool-actions--center">
                        <button class="btn btn--primary btn--cta" type="button" id="openModalBtn">
                            Être prévenu (bêta) →
                        </button>
                    </div>

                    <div class="mini-benefits">
                        <div class="mini-benefit">✓ Gagne du temps</div>
                        <div class="mini-benefit">✓ Champs déjà prêts</div>
                        <div class="mini-benefit">✓ Export Factur-X</div>
                    </div>

                    <p class="fineprint" style="margin-top:12px;">
                        Objectif : savoir si des gens sont prêts à payer. Merci 🙏
                    </p>
                </div>
            </div>
        </section>

        <!-- Modal (PoC) -->
        <div class="modal" id="betaModal" aria-hidden="true">
            <div class="modal__backdrop" data-close></div>

            <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                <button class="modal__close" type="button" aria-label="Fermer" data-close>×</button>

                <h2 id="modalTitle">Modèles en développement</h2>
                <p class="muted">Laisse ton email et on te prévient dès que l’accès est prêt.</p>

                <!-- ✅ Formspree -->
                <form class="modal__form" id="betaForm" action="https://formspree.io/f/xjkndglk" method="POST">
                    <!-- context -->
                    <input type="hidden" name="tool" value="templates" />
                    <input type="hidden" name="page" value="templates" />
                    <input type="hidden" name="template" id="chosenTemplate" value="" />
                    <input type="hidden" name="_subject" value="ConvertFacture — Demande bêta (Templates)" />

                    <!-- honeypot anti-spam -->
                    <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off" aria-hidden="true" />

                    <div id="formStep">
                        <input class="input" name="email" type="email" placeholder="Ton email" required />

                        <select class="input" name="profile" required>
                            <option value="" disabled selected>Quel profil te décrit le mieux ?</option>
                            <option>Freelance</option>
                            <option>Artisan / BTP</option>
                            <option>Agence</option>
                            <option>E-commerce</option>
                            <option>Autre</option>
                        </select>

                        <select class="input" name="price" required>
                            <option value="" disabled selected>Prix acceptable</option>
                            <option>9€ / mois</option>
                            <option>19€ / mois</option>
                            <option>49€ / mois</option>
                            <option>Je préfère payer à l’usage</option>
                            <option>Je ne paierai pas</option>
                        </select>

                        <button class="btn btn--primary btn--cta" type="submit" id="submitBtn">Me prévenir →</button>
                        <p class="fineprint">Pas de spam. Juste un mail quand la bêta est prête.</p>

                        <p class="fineprint" id="formError" style="display:none; color: rgba(239,68,68,0.95);">
                            Oups — impossible d’envoyer pour l’instant. Réessaie dans quelques secondes.
                        </p>
                    </div>

                    <div id="thanksStep" style="display:none;">
                        <h3 style="margin:6px 0 0;">Merci 🙌</h3>
                        <p class="muted" style="margin-top:8px;">
                            On te contactera dès que l’accès à ce plan est prêt.
                        </p>
                        <button class="btn btn--primary btn--cta" type="button" id="closeAfterThanks">Fermer</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer__inner">
            <span>© <span id="year"></span> ConvertFacture</span>
            <span class="footer__sep">·</span>
            <a class="link" href="../pricing.html">Tarifs</a>
            <span class="footer__sep">·</span>
            <a class="link" href="../contact.html">Contact</a>
        </div>

        <script>
            // Footer year
            const yearEl = document.getElementById("year");
            if (yearEl) yearEl.textContent = new Date().getFullYear();

            // Elements
            const modal = document.getElementById("betaModal");
            const dropzone = document.getElementById("dropzone");
            const openBtn = document.getElementById("openModalBtn");
            const tplCards = document.querySelectorAll(".tpl-card");

            const form = document.getElementById("betaForm");
            const templateHidden = document.getElementById("chosenTemplate");

            const formStep = document.getElementById("formStep");
            const thanksStep = document.getElementById("thanksStep");
            const closeAfterThanks = document.getElementById("closeAfterThanks");
            const submitBtn = document.getElementById("submitBtn");
            const formError = document.getElementById("formError");

            let chosenTemplate = ""; // freelance/artisan/agence/ecommerce

            function setTemplate(value) {
                chosenTemplate = value || "";
                if (templateHidden) templateHidden.value = chosenTemplate;
            }

            function resetModalUI() {
                if (formStep) formStep.style.display = "";
                if (thanksStep) thanksStep.style.display = "none";
                if (formError) formError.style.display = "none";
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "Me prévenir →";
                }
                // assure que le hidden template est bien à jour
                if (templateHidden) templateHidden.value = chosenTemplate;
            }

            function openModal() {
                if (!modal) return;
                resetModalUI();
                modal.classList.add("modal--open");
                modal.setAttribute("aria-hidden", "false");
                document.body.style.overflow = "hidden";

                const emailInput = modal.querySelector("input[type='email']");
                if (emailInput) emailInput.focus();
            }

            function closeModal() {
                if (!modal) return;
                modal.classList.remove("modal--open");
                modal.setAttribute("aria-hidden", "true");
                document.body.style.overflow = "";
            }

            // Template click -> set + open
            tplCards.forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    setTemplate(btn.getAttribute("data-template"));
                    openModal();
                });
            });

            // Dropzone click (outside cards) -> open generic
            if (dropzone) {
                dropzone.addEventListener("click", (e) => {
                    if (e.target && e.target.closest && e.target.closest(".tpl-card")) return;
                    setTemplate("");
                    openModal();
                });

                dropzone.addEventListener("keypress", (e) => {
                    if (e.key === "Enter" || e.key === " ") {
                        setTemplate("");
                        openModal();
                    }
                });
            }

            // Button open
            if (openBtn) {
                openBtn.addEventListener("click", () => {
                    setTemplate("");
                    openModal();
                });
            }

            // Close modal
            if (modal) {
                modal.querySelectorAll("[data-close]").forEach((el) => el.addEventListener("click", closeModal));
            }
            window.addEventListener("keydown", (e) => {
                if (e.key === "Escape") closeModal();
            });
            if (closeAfterThanks) closeAfterThanks.addEventListener("click", closeModal);

            // ✅ AJAX submit -> Formspree
            if (form) {
                form.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    if (formError) formError.style.display = "none";

                    // assure que le template est bien dans le payload
                    if (templateHidden) templateHidden.value = chosenTemplate;

                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.textContent = "Envoi…";
                    }

                    try {
                        const res = await fetch(form.action, {
                            method: "POST",
                            body: new FormData(form),
                            headers: { "Accept": "application/json" }
                        });

                        if (res.ok) {
                            if (window.gtag) gtag("event", "beta_signup", { tool: "templates" });
                            if (formStep) formStep.style.display = "none";
                            if (thanksStep) thanksStep.style.display = "";

                            // reset champs visibles (mais on garde chosenTemplate)
                            form.reset();
                            if (templateHidden) templateHidden.value = chosenTemplate;
                        } else {
                            if (formError) formError.style.display = "";
                            if (submitBtn) {
                                submitBtn.disabled = false;
                                submitBtn.textContent = "Me prévenir →";
                            }
                        }
                    } catch (err) {
                        if (formError) formError.style.display = "";
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.textContent = "Me prévenir →";
                        }
                    }
                });
            }
        </script>
    </footer>
</body>
</html>
